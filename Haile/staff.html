<!DOCTYPE html>
<html>
<head>
    <title>INTERNAL - Haile Selassie</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

   <style>
      /* --- THEME VARIABLES --- */
      :root {
          --bg-color: #1a1a1a;
          --panel-bg: rgba(30, 30, 30, 0.85);
          --accent-red: #d93025;
          --text-main: #e0e0e0;
          --text-muted: #888;
          --meta-val-color: white;
      }

      /* --- LIGHT THEME OVERRIDES --- */
      body.light-theme {
          --text-main: #333;
          --text-muted: #555;
          --meta-val-color: #1a1a1a;
          --panel-bg: rgba(255, 255, 255, 0.85);
      }

      body { 
          margin: 0; height: 100%; width: 100%; 
          background-color: var(--bg-color); 
          font-family: 'Lato', sans-serif; 
          overflow: hidden; color: var(--text-main); 
          transition: background-color 0.3s ease, color 0.3s ease;
      }
      
      /* --- SECURITY HEADER --- */
      .staff-header {
          position: absolute; top: 0; left: 0; right: 0; height: 32px;
          background: var(--accent-red); color: white;
          font-family: 'Lato', sans-serif; font-size: 10px; font-weight: 700;
          letter-spacing: 3px; text-transform: uppercase;
          display: flex; align-items: center; justify-content: center;
          z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      }

      /* --- METADATA OVERLAY --- */
      .meta-data {
          position: absolute; top: 60px; left: 30px;
          z-index: 10; pointer-events: none;
      }
      .meta-block { margin-bottom: 25px; border-left: 1px solid var(--accent-red); padding-left: 15px; }
      .meta-label { 
          font-size: 10px; text-transform: uppercase; letter-spacing: 1.5px; 
          color: var(--text-muted); display: block; margin-bottom: 4px;
      }
      .meta-val { 
          font-family: 'Playfair Display', serif; font-size: 1.2em; 
          color: var(--meta-val-color);
          font-weight: 400; font-style: italic;
          transition: color 0.3s ease;
      }
      .meta-val.id-code { font-family: 'Lato', sans-serif; font-style: normal; font-size: 1em; }

      /* --- TOOLS PANEL --- */
      .tools-panel {
          position: absolute; top: 60px; right: 30px;
          width: 240px;
          background: var(--panel-bg);
          backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
          border: 1px solid rgba(100,100,100,0.2); border-radius: 8px;
          padding: 20px;
          z-index: 50;
          max-height: 85vh; overflow-y: auto;
          box-shadow: 0 10px 40px rgba(0,0,0,0.2);
          transition: background-color 0.3s ease, transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      
      .tool-group { margin-bottom: 25px; }
      .tool-label { 
          font-size: 9px; font-weight: 700; letter-spacing: 1.5px; 
          text-transform: uppercase; color: var(--text-muted); 
          margin-bottom: 12px; display: block; 
      }
      
      /* --- CUSTOM SLIDERS --- */
      input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
      input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 2px; background: #999; border-radius: 2px; }
      input[type=range]::-webkit-slider-thumb {
          -webkit-appearance: none; height: 14px; width: 14px; border-radius: 50%;
          background: var(--accent-red); margin-top: -6px; cursor: pointer;
          border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }
      
      /* --- BUTTONS --- */
      .action-btn {
          width: 100%; padding: 10px 0; margin-bottom: 8px;
          background: rgba(128,128,128,0.1); border: 1px solid rgba(128,128,128,0.2); 
          color: var(--text-main); font-family: 'Lato', sans-serif; font-size: 10px; font-weight: 700; letter-spacing: 1px;
          cursor: pointer; transition: all 0.2s; border-radius: 4px;
      }
      .action-btn:hover { background: rgba(128,128,128,0.2); border-color: var(--text-muted); }
      .action-btn.active { background: var(--accent-red); border-color: var(--accent-red); color: white; }

      .swatch-grid { display: flex; gap: 8px; margin-bottom: 8px; }
      .swatch-btn { 
          flex: 1; padding: 10px 0; border: 1px solid rgba(128,128,128,0.2); background: transparent;
          cursor: pointer; font-size: 9px; font-weight: 700; font-family: 'Lato', sans-serif; 
          color: var(--text-muted); border-radius: 4px; transition: all 0.2s;
      }
      .swatch-btn:hover { border-color: var(--text-main); color: var(--text-main); }
      .swatch-btn.active { border-color: var(--accent-red); color: var(--accent-red); background: rgba(217, 48, 37, 0.1); }

      .logout-btn { border-color: #666; color: var(--text-muted); margin-top: 15px; }
      .logout-btn:hover { border-color: var(--accent-red); color: var(--accent-red); background: transparent; }

      .exit-link { 
          display: block; text-align: center; margin-top: 15px; 
          font-size: 9px; color: var(--text-muted); text-decoration: none; letter-spacing: 1px; transition: color 0.2s;
      }
      .exit-link:hover { color: var(--accent-red); }

      /* --- MOBILE --- */
      #mobile-menu-btn {
          display: none;
          position: absolute; top: 45px; right: 20px; z-index: 60;
          background: var(--panel-bg); color: var(--text-main); border: 1px solid #999;
          padding: 8px 12px; border-radius: 4px;
          font-family: 'Lato', sans-serif; font-weight: 700; font-size: 10px; letter-spacing: 1px;
          cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
          backdrop-filter: blur(10px);
      }

      @media (max-width: 600px) {
          .tools-panel { display: none; top: 90px; right: 20px; width: 65%; max-width: 280px; }
          .tools-panel.open { display: block; }
          #mobile-menu-btn { display: block; }
          .meta-data { top: auto; bottom: 30px; left: 20px; }
          .meta-block { margin-bottom: 15px; border-left: none; padding-left: 0; }
          .meta-val { font-size: 1.1em; }
      }

      /* --- LOGIN --- */
      #login-overlay {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: #111; z-index: 9999;
          display: flex; flex-direction: column; align-items: center; justify-content: center;
      }
      .login-box { text-align: center; width: 300px; padding: 40px; border: 1px solid #333; border-radius: 8px; }
      .login-input {
          width: 100%; padding: 14px; margin: 20px 0 10px 0;
          background: #222; border: 1px solid #444; color: white;
          font-family: 'Lato', sans-serif; text-align: center; letter-spacing: 2px;
          box-sizing: border-box; border-radius: 4px; transition: border-color 0.2s;
      }
      .login-input:focus { outline: none; border-color: var(--accent-red); }
      .login-btn {
          width: 100%; padding: 14px; background: white; border: 1px solid white;
          font-family: 'Lato', sans-serif; font-weight: 700; letter-spacing: 1px; font-size: 11px;
          cursor: pointer; box-sizing: border-box; border-radius: 4px; transition: all 0.2s;
      }
      .login-btn:hover { background: #ddd; border-color: #ddd; }

      model-viewer { width: 100vw; height: 100vh; outline: none; --poster-color: transparent; }
   </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color:white; font-family:'Playfair Display', serif; font-weight:400; margin:0; letter-spacing: 1px;">Restricted Access</h2>
            <div style="width: 40px; height: 1px; background: var(--accent-red); margin: 15px auto;"></div>
            <input type="password" id="password-input" class="login-input" placeholder="PASSCODE">
            <button class="login-btn" onclick="checkPassword()">AUTHENTICATE</button>
            <div id="error-msg" style="color: var(--accent-red); font-size: 10px; margin-top: 15px; display: none; letter-spacing: 1px;">ACCESS DENIED</div>
        </div>
    </div>

    <div class="staff-header">Wolfsonian Collection Database &bull; Internal</div>

    <button id="mobile-menu-btn" onclick="toggleTools()">TOOLS</button>

    <div class="meta-data">
        <div class="meta-block">
            <span class="meta-label">Accession ID</span>
            <span class="meta-val id-code">87.1321.6.1</span>
        </div>
        <div class="meta-block">
            <span class="meta-label">Object</span>
            <span class="meta-val object-name">Haile Selassie Bust</span>
        </div>
        <div class="meta-block">
            <span class="meta-label">Year</span>
            <span class="meta-val">1937</span>
        </div>
        <div class="meta-block">
            <span class="meta-label">Condition</span>
            <span class="meta-val">Stable - Minor Oxidation</span>
        </div>
    </div>

    <div class="tools-panel" id="tools-panel">
        <div class="tool-group">
            <span class="tool-label">Inspection</span>
            <button class="action-btn" id="clay-btn" onclick="toggleClayMode()">TOGGLE CLAY RENDER</button>
            <button class="action-btn" onclick="resetView()">RESET CAMERA</button>
        </div>

        <div class="tool-group">
            <span class="tool-label">Background</span>
            <div class="swatch-grid">
                <button class="swatch-btn" style="background:#1a1a1a;" onclick="setBg('dark')">DARK</button>
                <button class="swatch-btn" style="background:#f4f4f4; color:#222;" onclick="setBg('light')">LIGHT</button>
                <button class="swatch-btn" style="background:#00ff00; color:#000;" onclick="setBg('key')">KEY</button>
            </div>
        </div>

        <div class="tool-group">
            <span class="tool-label">Lighting Style</span>
            <div class="swatch-grid">
                <button class="swatch-btn" onclick="setLightPreset('flat')">FLAT</button>
                <button class="swatch-btn active" onclick="setLightPreset('std')">STD</button>
                <button class="swatch-btn" onclick="setLightPreset('drama')">DRAMA</button>
            </div>
        </div>

        <div class="tool-group">
            <span class="tool-label">Exposure</span>
            <input type="range" id="exp-slider" min="0.5" max="2.5" step="0.1" value="1" oninput="updateExposure(this.value)">
        </div>
        
        <div class="tool-group">
            <span class="tool-label">Shadow Softness</span>
            <input type="range" id="shadow-slider" min="0" max="1" step="0.1" value="0" oninput="updateShadows(this.value)">
        </div>

        <div class="tool-group">
            <span class="tool-label">Assets</span>
            <button class="action-btn" onclick="captureStaffScreenshot()">CAPTURE SCREENSHOT</button>
            <a href="Haile.glb" download style="text-decoration:none;">
                <button class="action-btn">DOWNLOAD .GLB</button>
            </a>
        </div>

        <button class="action-btn logout-btn" onclick="logout()">ðŸ”’ LOCK DEVICE</button>
        <a href="index.html" class="exit-link">&larr; EXIT TO PUBLIC GALLERY</a>
    </div>

    <model-viewer 
      id="viewer"
      onclick="closeToolsOnMobile()"
      src="Haile.glb"
      orientation="0deg 0deg 180deg" 
      alt="Staff View" 
      camera-controls 
      shadow-intensity="1" 
      exposure="1" 
      tone-mapping="neutral">
    </model-viewer>

    <script>
        const viewer = document.getElementById('viewer');

        // --- AUTH ---
        if (sessionStorage.getItem('staff_auth') === 'true') {
            document.getElementById('login-overlay').style.display = 'none';
        }

        function checkPassword() {
            const input = document.getElementById('password-input').value;
            if (input === 'wolfsonian') { 
                sessionStorage.setItem('staff_auth', 'true');
                document.getElementById('login-overlay').style.display = 'none';
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }
        function logout() {
            sessionStorage.removeItem('staff_auth');
            location.reload(); 
        }
        document.getElementById('password-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') { checkPassword(); }
        });

        // --- UI ---
        function toggleTools() { document.getElementById('tools-panel').classList.toggle('open'); }
        function closeToolsOnMobile() { if (window.innerWidth <= 600) { document.getElementById('tools-panel').classList.remove('open'); } }
        
        // --- NEW: INTELLIGENT THEME SWITCHING ---
        function setBg(mode) {
            const body = document.body;
            let color = '#1a1a1a'; // default dark

            if (mode === 'light') {
                body.classList.add('light-theme');
                color = '#f4f4f4';
            } else if (mode === 'key') {
                body.classList.remove('light-theme'); 
                color = '#00ff00';
            } else {
                body.classList.remove('light-theme'); 
                color = '#1a1a1a';
            }
            
            body.style.backgroundColor = color;
            viewer.style.backgroundColor = color;
        }

        // --- FEATURES ---
        let isClay = false;
        let originalTexture = null;

        function toggleClayMode() {
            if (!viewer.model || !viewer.model.materials) return;
            const material = viewer.model.materials[0];
            const btn = document.getElementById('clay-btn');
            
            if (!isClay) {
                originalTexture = material.pbrMetallicRoughness.baseColorTexture.texture;
                material.pbrMetallicRoughness.baseColorTexture.setTexture(null);
                material.pbrMetallicRoughness.setBaseColorFactor([0.8, 0.8, 0.8, 1]);
                btn.classList.add('active');
                btn.innerText = "RESTORE TEXTURE";
                isClay = true;
            } else {
                material.pbrMetallicRoughness.baseColorTexture.setTexture(originalTexture);
                material.pbrMetallicRoughness.setBaseColorFactor([1, 1, 1, 1]);
                btn.classList.remove('active');
                btn.innerText = "TOGGLE GEOMETRY / CLAY";
                isClay = false;
            }
        }

        function setLightPreset(style) {
            const exp = document.getElementById('exp-slider');
            const shd = document.getElementById('shadow-slider');
            if (style === 'flat') { updateExposure(1.2); updateShadows(1); viewer.shadowIntensity = 0; }
            else if (style === 'std') { updateExposure(1); updateShadows(0.5); viewer.shadowIntensity = 1; }
            else if (style === 'drama') { updateExposure(0.8); updateShadows(0); viewer.shadowIntensity = 2; }
            
            if(exp) exp.value = viewer.exposure;
            if(shd) shd.value = viewer.shadowSoftness;

            const btns = document.querySelectorAll('.tool-group .swatch-btn');
            btns.forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        function updateExposure(val) { viewer.exposure = Number(val); }
        function updateShadows(val) { viewer.shadowSoftness = Number(val); }
        function resetView() { viewer.cameraOrbit = "0deg 75deg 105%"; viewer.fieldOfView = "auto"; }

        async function captureStaffScreenshot() {
            const bgColor = window.getComputedStyle(document.body).backgroundColor;
            const blob = await viewer.toBlob({ mimeType: 'image/png', qualityArgument: 1, idealAspect: true, width: 2000, height: 2000 });
            const blobUrl = URL.createObjectURL(blob);
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width; canvas.height = img.height;
                ctx.fillStyle = bgColor;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
                const link = document.createElement('a');
                let objName = "Object";
                try { objName = document.querySelector('.object-name').innerText.replace(/[^a-zA-Z0-9]/g, '_'); } catch(e) {}
                link.download = `Wolfsonian_Staff_${objName}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
                URL.revokeObjectURL(blobUrl);
            };
            img.src = blobUrl;
        }
    </script>
</body>
</html>
